<div class="breadcrumb-div">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a routerLink="/home/dashboard/">{{'label.ManageServices.Home' | translate}} </a></li>
    <li class="breadcrumb-item active">{{role.menuLabel}}</li>
  </ol>
</div>
<div class="inner-head">
  <h2>{{role.menuLabel}}</h2>
  <!-- <h2>{{role.menuLabel}}</h2> -->
</div>

<div class="row">
  <div class="status-filter">

    <!-- <div class="col-sm-6 col-md-5 col-xs-12">
            <div class="form-group">
                <label>Status</label>
                <div class="styled-select">
                    <select class="form-control" [(ngModel)]="reqObj.statusFilter" id="listServices" (change)="onChange($event.target.value)">
          <option value="undefined" selected disabled> Select Service</option>
          <option *ngFor="let status of status; let i = index" value="{{status.id}}">
            {{status.statusDesc}}</option>
          </select>
                    <span class="fa fa-sort-desc"></span>
                </div>
            </div>
        </div> -->
    <div class="col-xs-12">
      <div class="tablesearch-sort">
        <div class="tablesearch-sort">
          <div class="search-input">
            <div class="searchexpand">
              <input type="text" id="searchTextId" placeholder="{{'label.ManageServices.Search' | translate}}"
                [(ngModel)]="SearchValue" />
              <button type="submit"><i class="icon-search"></i></button>
            </div>
            <span class="icon-search"></span>
            <span class="icon-close1 closesearch" (click)="clearAllFilter()"></span>
          </div>
          <div class="search-value"
            *ngIf="reqObj.isChannelFilter || reqObj.isStatusFilter || reqObj.isApprovalStatusFilter">
            <p class="sortby-title">{{'label.ManageServices.Filteredby' | translate}}</p>
            <p *ngIf="reqObj.isChannelFilter">{{'label.ManageServices.Channel' | translate}} <i (click)="clearChannel()"
                class="icon-close1"></i></p>
            <p *ngIf="reqObj.isStatusFilter">{{'label.ManageServices.Status' | translate}} <i (click)="clearStatus()"
                class="icon-close1"></i></p>
            <p *ngIf="reqObj.isApprovalStatusFilter">{{'label.ManageServices.Status' | translate}} <i
                (click)="clearApprovedStatus()" class="icon-close1"></i>
            </p>
            <p class="clearall" (click)="clearAllFilter()">{{'label.ManageServices.ClearAll' | translate}}</p>
          </div>
        </div>
      </div>
      <!-- <div class="search-box visible-xs">
                <div class="icon-search main-search search-remove"></div>
                <div class="search-box1">
                    <input type="text" placeholder="Search" [(ngModel)]="reqObj.searchText" (ngModelChange)="changeSearch()" />
                    <div class="icon-search"></div>
                </div>
            </div> -->
      <div class="button-orange">
        <a [class.disabled]="getAccessRole('isAdd')"
          (click)="addService()">{{'label.ManageServices.AddServices' | translate}} <span class="icon-plus"></span></a>
      </div>
    </div>
  </div>
</div>

<div class="search-results" infiniteScroll [infiniteScrollDistance]="5" [infiniteScrollThrottle]="20">
  <div class="no-record" *ngIf="!listServices.length" style="display:none;">
    {{'label.ManageServices.NoRecordsFound' | translate}}
  </div>
</div>
<div class="responsive-nt">
  <table class="table  datatable table-visible">
    <thead>
      <tr>
        <th scope="col">
          {{'label.ManageServices.ServiceID' | translate}}
          <!-- <span class="icon-sub-user-filter sorting"></span> -->
        </th>
        <th scope="col">
          {{'label.ManageServices.Service' | translate}}
          <!-- <span class="icon-sub-user-filter sorting active"></span> -->
        </th>
        <th scope="col">
          {{'label.ManageServices.Category' | translate}}
          <!-- <span class="icon-sub-user-filter sorting"></span> -->
        </th>
        <th scope="col">
          {{'label.ManageServices.Channel' | translate}}
          <span class="icon-uniE90D user-arrow filter-open"></span>
          <div class="table-checkfilter">
            <div class="searchbox">
              <input type="text" placeholder="{{'label.ManageServices.Search' | translate}}  " />
            </div>
            <div class="tablesearch-content">
              <ul>
                <li *ngFor="let item of tableChannel">
                  <div class="checkbox">
                    <label>
                      <input (change)="ChannelChange()" type="checkbox" [(ngModel)]="item.isChecked" />
                      <span class="cr"><i class="cr-icon fa fa-check"></i></span>{{item.name}}
                      &nbsp;&nbsp;</label>
                  </div>
                </li>

              </ul>
            </div>
          </div>
        </th>
        <th scope="col">
          {{'label.ManageServices.Status' | translate}}
          <span class="icon-uniE90D user-arrow filter-open"></span>
          <div class="table-checkfilter">
            <div class="searchbox">
              <input type="text" placeholder="{{'label.ManageServices.Search' | translate}}" />
            </div>
            <div class="tablesearch-content">
              <ul>
                <li>
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" [(ngModel)]="statusActive" (change)="onStatusChange('true')" />
                      <span class="cr"><i
                          class="cr-icon fa fa-check"></i></span>{{'label.ManageServices.Active' | translate}}
                      &nbsp;&nbsp;</label>
                  </div>
                </li>
                <li>
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" [(ngModel)]="statusInActive" (change)="onStatusChange('false')" />
                      <span class="cr"><i
                          class="cr-icon fa fa-check"></i></span>{{'label.ManageServices.Inactive' | translate}}
                      &nbsp;&nbsp;</label>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </th>
        <th>
          {{'label.ManageServices.ApprovalStatus' | translate}}
          <span class="icon-uniE90D user-arrow filter-open"></span>
          <div class="table-checkfilter">
            <div class="searchbox">
              <input type="text" placeholder="{{'label.ManageServices.Search' | translate}}" />
            </div>
            <div class="tablesearch-content">
              <ul>
                <li>
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" [(ngModel)]="statusApproved"
                        (change)="onApprovalStatusChange('Approved')" />
                      <span class="cr"><i
                          class="cr-icon fa fa-check"></i></span>{{'label.ManageServices.Approved' | translate}}
                      &nbsp;&nbsp;</label>
                  </div>
                </li>
                <li>
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" [(ngModel)]="statusDraft" (change)="onStatusChange('Draft')" />
                      <span class="cr"><i
                          class="cr-icon fa fa-check"></i></span>{{'label.ManageServices.Draft' | translate}}
                      &nbsp;&nbsp;</label>
                  </div>
                </li>
                <!-- <li>
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" [(ngModel)]="statusPending"
                        (change)="onApprovalStatusChange('Rejected')" />
                      <span class="cr"><i class="cr-icon fa fa-check"></i></span>{{'label.ManageServices.Rejected' | translate}} 
                      &nbsp;&nbsp;</label>
                  </div>
                </li> -->

                <li>
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" [(ngModel)]="statusReopen" (change)="onApprovalStatusChange('Reopen')" />
                      <span class="cr"><i
                          class="cr-icon fa fa-check"></i></span>{{'label.ManageServices.Reopen' | translate}}
                      &nbsp;&nbsp;</label>
                  </div>
                </li>

                <li>
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" [(ngModel)]="statusPendingForApproval"
                        (change)="onApprovalStatusChange('Pending For Approval')" />
                      <span class="cr"><i
                          class="cr-icon fa fa-check"></i></span>{{'label.ManageServices.PendingForApproval' | translate}}
                      &nbsp;&nbsp;</label>
                  </div>
                </li>

              </ul>
            </div>
          </div>
        </th>

        <th scope="col" class="text-align">{{'label.ManageServices.Actions' | translate}}</th>
        <!-- <th class="text-align" scope="col" *ngIf="reqObj.statusFilter=='2' || reqObj.statusFilter=='3'">Actions</th> -->
      </tr>
    </thead>
    <!--   </table>
         </div>
        <div class="tablebody">
            <table class="table datatable"> -->
    <tbody>
      <tr *ngFor="let service of listServices">
        <td class="hover-hand ellipsis" (click)="gotoDefaultService(service)">
          <a title="{{service.notiId}}" data-toggle="tooltip">{{service.notiId}}</a>
        </td>
        <td class="ellipsis">
          <a title="{{service.notiDesc}}" data-toggle="tooltip"> {{service.notiDesc}}</a></td>
        <td>{{getCategoryName(service.categoryId)}}</td>
        <td class="ellipsis">
          <a title="{{getChannelName(service.channelId)}}"
            data-toggle="tooltip">{{getChannelName(service.channelId)}}</a></td>
        <td data-th="Status">
          <p *ngIf="service.isActive=='true'"><i class="fa fa-check"></i>Active </p>
          <p *ngIf="service.isActive=='false'"><i class="fa fa-times"></i>Inactive </p>
        </td>
        <td data-th="Status" class="ellipsis">
          <a title="{{service.status}}" data-toggle="tooltip"> <i class="icon-approve"
              *ngIf="service.status=='Approved' "></i>
            <i class="icon-draft" *ngIf="service.status=='Draft'"></i>
            <i class="icon-reject" *ngIf="service.status=='Rejected'"></i>
            <i class="icon-reopen" *ngIf="service.status=='Reopen'"></i>
            <i class="icon-pending" *ngIf="service.status=='Pending For Approval'"></i> {{service.status}}</a>
        </td>

        <td data-th="Actions" class="text-align">
          <div *ngIf=" service.status=='Approved'" [class.disabled]="getAccessRole('isDelete')" class="text-align">
            <i class="icon-delete column6" (click)="showModal(service.notiId)" title="Delete" data-toggle="tooltip"
              data-placement="left"></i>
          </div>
          <div *ngIf=" service.status=='Draft' && (user.userId == service.makerUserId)"
            [class.disabled]="getAccessRole('isDelete')" class="text-align">
            <i class="icon-delete column6" (click)="showModalDraft(service.wfId)" title="Delete" data-toggle="tooltip"
              data-placement="left"></i>
          </div>

          <div *ngIf="service.status=='Pending For Approval' && 
                        (user.userId!=service.makerUserId||user.data.isAdminUser)"
            [class.disabled]="getAccessRole('isChecker')">


            <i class="icon-returnmaker"
              *ngIf="service.status=='Pending For Approval' && (user.userId!=service.makerUserId||user.data.isAdminUser)"
              title="Return to Maker" (click)="reopenServices(service)" data-toggle="tooltip" data-placement="left"></i>
            <div class="statuschange" *ngIf="service.status=='Pending For Approval'">
              <i class="icon-status-change dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false"></i>
              <i class="icon-close1 dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false"></i>
              <div class="statuschange-list dropdown-menu dropdown-menu-right">
                <p (click)="approveServices(service)"><i
                    class="icon-approve"></i>{{'label.ManageServices.Approve' | translate}}
                </p>
                <p (click)="rejectServices(service)"><i class="icon-reject"></i>
                  {{'label.ManageServices.Reject' | translate}} </p>
              </div>
            </div>
          </div>
        </td>

      </tr>
    </tbody>
  </table>


</div>

<div class="modal fade" id="serviceModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog notify-modal" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span class="icon-close1"></span>
        </button>
        <i class="icon-delete del-popup"></i>
        <h4>{{'label.ManageServices.Alertmessage' | translate}}</h4>
        <p>{{'label.ManageServices.Areyou' | translate}}</p>
        <a (click)="deleteService()" class="add-btn"><span>{{'label.ManageServices.Delete' | translate}}</span></a>
      </div>

    </div>
  </div>
</div>

<div class="modal fade" id="draftModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog notify-modal" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span class="icon-close1"></span>
        </button>
        <i class="icon-delete del-popup"></i>
        <h4>{{'label.ManageServices.Alertmessage' | translate}}</h4>
        <p>{{'label.ManageServices.Areyou' | translate}}</p>
        <a (click)="deleteDraft()" class="add-btn"><span>{{'label.ManageServices.Delete' | translate}}</span></a>
      </div>

    </div>
  </div>
</div>

<div class="modal fade" id="userModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog notify-modal" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span class="icon-close1"></span>
        </button>
        <i class="fa fa-bell-o"></i>
        <h4>{{selectedService.title}}</h4>
        <p>{{selectedService.body}}</p>
        <div *ngIf="this.serviceStatus != 2" class="text-areabox">
          <label>{{'label.ManageServices.Reason' | translate}}</label>
          <form [formGroup]="AppOrRejForm">
            <textarea [(ngModel)]="selectedService.reason" formControlName="reason" class="form-control"
              (input)='changeField($event,"[^0-9 a-zA-Z\u0600-\u06FF/\s/g]","1","250","reason",selectedService.reason.length)'></textarea>
            <span>{{'label.ManageServices.Max250' | translate}}</span>
            <div *ngIf="errMsg" class="error error-position error-right">
              {{'label.ManageServices.EnterReason' | translate}}</div>
          </form>
        </div>

        <a (click)="send()" *ngIf="this.serviceStatus == 2"
          class="add-btn"><span>{{'label.ManageServices.Approve' | translate}}</span></a>
        <!-- <a (click)="send()" *ngIf="this.serviceStatus == 4" class="add-btn"><span>{{'label.ManageServices.Reject' | translate}}</span></a> -->
        <a (click)="send()" *ngIf="this.serviceStatus == 5" class="add-btn"><span>
            {{'label.ManageServices.ReturnToMaker' | translate}}
          </span></a>

      </div>

    </div>
  </div>
</div>